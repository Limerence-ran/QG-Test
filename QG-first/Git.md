# Git 分布式版本控制系统 #

### 版本控制软件 ###

版本控制软件是一个用来**记录文件变化**，以便将来查阅特定版本修订情况的系统，因此有时也叫做“**版本控制系统**”。  

***

使用版本控制软件的好处：

* **操作简便**，只需识记几组简单的终端命令，即可快速上手常见的版本控制软件。
* **易于对比**，即将于版本控制软件提供的功能，能够方便的比较文件的细节，从而找出导致问题的原因。
* **易于回溯**，可以将选定的文件回溯到之前的状态，甚至将整个项目都会退到过去某个时间点的状态。
* **不易丢失**，在版本控制软件中，被用户误删除的文件，可以轻松地回复回来。
* **协作方便**，基于版本控制额软件提供的分支功能，可以轻松实现多人协作开发是的代码合并操作。

***

### 版本控制系统的分类

1. 本地版本控制系统

   特点：使用软件来记录文件的不同版本，提高了工作效率，降低了手动维护版本的出错率

   缺点：（1）**单机运行，不支持多人协作开发**

   ​			（2）版本数据库故障后，所有历史更新记录会丢失

2. 集中化的版本控制系统

   特点：基于**服务器、客户端**的运行模式

   （1）服务器保存文件的所有更新记录

   （2）客户端**只保留最新的文件版本**

   优点：联网运行，支持多人协作开发

   缺点：（1）不支持离线服务提交版本更新

   ​			（2）中心服务器崩溃后，所有人无法正常工作

   ​			（3）版本数据库故障后，所有历史更新记录会丢失

3. 分布式版本控制系统

   特点：基于**服务器、客户端**的运行模式

   * 服务器保存文件的所有更新版本
   * **客户端是服务器的完整备份**，并不只是保留文件的最新版本

   优点：（1）联网运行，支持多人协作开发

   ​			（2）客户端**断网**后**支持离线本地提交**版本更新

   ​			（3）服务器故障或损坏后，可使用任何一个客户端的备份进行恢复

***



### Git 基础概念 ###

***

#### 什么是Git ####

Git是一个**开源的分布式版本控制系统**，是目前世界上**最先进、最流行**的版本控制系统。可以快速高效地处理从很小到非常大的项目版本管理。

特点：项目越大越复杂，协同开发者多，越能体现出Git的**高性能**和**高复用性**

***

#### Git的特性

Git之所以快速和高效，主要依赖于它的如下两个特性：

* 直接记录快照，而非差异比较
* 近乎所有操作都是本地执行

***

#### Git的记录快照

**Git快照**是在原有文件版本的基础上重新生成一份新的文件，**类似于备份**。为了效率，如果文件没有被修改，Git不再重新存储该文件，而是只保留一个链接指向之前存储的文件。

缺点：占用磁盘空间较大

优点：**版本切换时非常快**，因为每个版本都是完整的文件快照，切换版本时直接恢复目标版本的快照即可

特点：**空间换时间**

***

#### Git中的三个区域

工作区：处理工作的区域

暂存区：已完成的工作的**临时存放区域**，**等待被提交**

Git仓库：最终的存放区域

***

#### Git中的三种状态

* 已修改（modified）：表示修改了文件，但还没将修改的结果放到暂存区
* 已暂存（staged）：表示对已修改文件的的当前版本做了标记，使之包含在下次提交的列表中
* 已提交（committed）：表示文件已经安全地保存在本地的Git仓库中

注意：

* 工作区的文件被修改了，但还没有放到暂存区，就是**已修改**状态
* 如果文件已修改并放入暂存区，就是**已暂存**状态
* 如果Git仓库中**保存着特定版本**的文件，就属于**已提交**状态

***

#### 基本的Git工作流程

1. 在工作区修改文件
2. 将你想要下次提交的更改进行暂存
3. 提交更新，找到暂存区的文件，将快照永久性存储到Git仓库

***

#### 安装并配置Git

[**官方下载地址**](https://git-scm.com/download)

配置用户信息：安装完Git之后，要做的第一件事就是设置自己的**用户名**和**邮件地址**。

因为通过Git对项目进行版本管理的时候，Git需要使用这些基本信息，来记录是谁对项目进行了操作

##### 1.配置用户信息

> ` git config --global user.name 'xxx' `
>
> `git config --global user.email 'xxx'`

**注意：如果使用了`--global`选项，那么该命令只需要运行一次，即可永久生效**

##### 2.Git的全局配置文件

配置的用户名和邮箱地址会被写入到**`C:/Users/用户名文件夹/.gitconfig`**全局配置文件中，可以使用记事本打开此文件进行查看自己对Git进行的配置。

##### 3.检查配置信息

除了可以使用记事本查看全局的配置信息之外，话可以运行如下的终端命令，快速的查看Git的全局配置信息：

`#查看所有的全局配置项:git config --list --global`

`#查看指定的全局配置项:git config user.name  ,  git config user.email`

##### 4.获取帮助信息

* 可以使用`git help <verb>`命令，无需联网即可在浏览器中打开帮助手册，例如：`#要想打开 git config 命令的帮助手册 git help config`
* 如果不想查看完整的手册，那么可以用-h选项活得更简明的“help”输出：`#想要获取git config 命令的快速参考 git config -h`

***

#### Git的基本操作

##### 1.获取Git仓库的两种方式

* 将尚未进行版本控制的**本地目录转换为Git仓库**
* 从其他服务器**克隆**一个已存在的Git仓库

以上两种方式都能够在自己的电脑上得到一个可用的Git仓库

***

##### 2.在现有目录中初始化仓库

如果自己有一个尚未进行版本控制的项目目录，想要用Git来控制它，需要执行如下两个步骤：

* 在项目目录中，通过鼠标右键打开“Git Bash”
* 执行**git init**命令将当前的目录转化成Git仓库

git init命令会创建一个名为.git的隐藏目录，**这个.git目录就是当前项目的Git仓库**，里面包含了**初始的必要文件**，这些文件是Git仓库的**必要组成部分**。

***

##### 3.工作区中文件的4种状态

工作区中的每一个文件可能有**4种状态**，这四种状态共分为两大类：

* **未被Git管理:未跟踪**
* **已被Git管理：**
  1.  未修改:工作区文件的内容和Git仓库中文件的内容**保持一致**
  2.  已修改:工作区中文件的内容和Git仓库中文件的内容**不一致**
  3.  已暂存:工作区中被修改的文件已被放到暂存区，准备将修改后的文件保存到Git仓库中

> Git操作的终极结果：让工作区的文件都处于“**未修改**”的状态

***

##### 4.检查文件状态

可以使用**git status**命令查看文件处于什么状态，例如：在状态报告中可以看到新建的文件出现在**Untracked files**(未跟踪的文件)下面。未跟踪的文件意味着**Git在之前的快照（提交）中没有这些文件**；Git不会自动将之纳入跟踪范围，除非明确地告诉它“我需要使用Git跟踪管理该文件”。

***

##### 5.以精简的方式显示文件状态

使用git status输出的状态报告很详细，但有些繁琐。如果希望**以精简的方式显示文件的状态**，可以使用如下两条完全等价的命令，其中**-s是--short的简写形式**：

`git status -s/git status --short`

未跟踪文件前面有**红色**的**??**标记，例如：`?? index.html`

***

##### 6.跟踪新文件

使用命令git add开始跟踪一个文件，所以要跟踪index.html文件，直接运行如下命令即可：

`git add index.html`

此时再运行**git status**命令，会看到index.html文件在**Changes to be committed**这行的下面，说明**已被跟踪**，并**处于暂存状态**。以精简的方式(`git status -s`)显示文件的状态：**新添加到暂存区**的文件前面有**绿色**的**A**标记。

***

##### 7.提交更新

现在暂存区中有一个index.html文件**等待被提交**到Git仓库中进行保存。可以执行**git commit**命令进行提交，其中**-m选项**后面是本次的**提交消息**，用来**对提交的内容做进一步的概述**：

`git commit -m "创建了index.html文件"`

提交成功后，再次检查文件的状态，得到提示如下：

`On branch master nothing to commit, working tree clean`

证明工作区中所有的文件都处于“**未修改**”的状态，**没有任何文件按需要被提交**。

***

##### 8.对已提交的文件进行修改

目前，index.html文件**已经被Git跟踪**，并且在**工作区和Git仓库**中的index.html

文件**内容保持一致**。当我们修改了工作区中的index.html的内容之后，再次运行**`git status和git status -s`**命令，会看到index.html文件出现在**`Changes not staged for commit`**这行下面，说明**已跟踪文件的内容发生了变化，但还没有放到暂存区**。

> 注意：修改过的，没有放入暂存区的文件前面有**红色**的**M**标记。

***

##### 9.暂存已修改的文件

目前，工作区中的index.html文件已被修改，如果要暂存这次修改，需要再次运行**`git add`**命令，这个命令是个多功能的命令，主要有如下3个功效：

1. 可以用它**开始跟踪新文件**
2. 把**已跟踪的、且已修改的**文件放到暂存区
3. 把有冲突的文件标记为已解决状态

***

##### 10.提交已暂存的文件

再次运行**`git commit -m "提交消息"`**命令，即可将暂存区中记录的index.html的快照，提交到Git仓库中进行保存。

***

##### 11.撤销对文件的修改

撤销对文件的修改指的是：把对工作区中对应文件的修改，**还原**成Git仓库中所保存的版本。

**`#使用git checkout -- index.html命令撤销对该文件的修改`**

操作的结果是：所有的修改会丢失，且无法恢复！**危险性比较高，请谨慎操作！**

> **撤销操作的本质是：**用Git仓库中保存的文件，覆盖工作区中指定的文件。

***

##### 12.向暂存区中一次性添加多个文件

如果需要被暂存的文件个数比较多，可以使用如下的命令，一次性将所有的新增和修改过的文件加入暂存区：**`git add . `**

> **今后在项目开发中，会经常使用这个命令，将新增和修改过的文件加入暂存区。**

***

##### 13.取消缓存的文件

如果需要从暂存区中移除对应的文件，可以使用如下的命令：**`git reset HEAD 要移除的文件名`**

***

##### 14.跳过使用暂存区域

Git标准的工作流程是**工作区⇀暂存区⇀Git仓库**，但有时候这么做略显繁琐，此时可以跳过暂存区，直接将工作区中的修改提交到Git仓库，这时候Git工作的流程简化为了“**工作区⇀Git仓库**”。

Git提供了一个跳过使用暂存区域的方式，只要在提交的时候，给**`git commit`**加上**`a`**选项，Git就会自动把所有已经跟踪过的文件暂存起来一并提交，从而跳过`git add`步骤:

**`git commit -a -m "描述消息"`**

***

##### 15.移除文件

从Git仓库中移除文件的方式有两种：

* 从Git仓库和工作区中**同时移除**对应的文件

  **`git rm -f index.js #从Git仓库和工作区中同时移除index.js文件`** 

* 只从Git仓库中移除指定的文件，但保留工作区中对应的文件

**`git rm --cached index.css #只从Git仓库中移除index.css，但保留工作区中的index.css`**

***

##### 16.忽略文件

一般我们总会有些文件无需纳入Git的管理，也不希望它们总出现在未跟踪文件列表。在这种情况下，我们可以创建一个名为**`.gitignore`**的配置文件，列出要忽略的文件的匹配模式。

**`文件.gitignore的格式规范如下：`**

1. 以**#开头**的是注释
2. 以**/结尾**的是目录
3. 以**/开头**防止递归
4. 以**!开头**表示取反
5. 可以使用**glob模式**进行文件和文件夹的匹配（glob指简化了的正则表达式）

***

##### 17.glob模式

所谓的**glob模式**是指简化了的正则表达式：

1. **星号***匹配**零个或多个任意字符**
2. **[abc]**匹配**任何一个列在方括号中的字符（此案例匹配一个a或匹配一个b或匹配一个c）
3. **问号?只匹配一个任意字符**
4. 在方括号中使用**短划线**分隔两个字符，表示所有在这两个字符范围内的都可以匹配（比如[0-9]表示匹配所有0到9的数字）
5. **两个星号****表示**匹配任意中间目录**（比如a/**/z可以匹配a/z、a/b/z或a/b/c/z等）

***

##### 18.查看提交历史

如果希望回顾项目的提交历史，可以使用**`git log`**这个简单且有效的命令。

`#按时间先后顺序列出所有的提交历史，数字可以按需进行填写  git log -2`

`#在一行上展示最近两条提交历史的信息  git log -2 --pretty=online`

**`#在一行上显示最近两条提交历史的信息，并自定义输出的格式`**

**`# %h 提交的简写哈希值 %an 作者名字 %ar 作者修订日期，按多久以前的方式显示 %s 提交说明 `**

**`#git log -2 --pretty=format:"%h | %an | %ar | %s"`**

***

##### 19.回退到指定的版本

**`#在一行内展示所有的提交历史 git log --pretty=oneline`**

**`#使用git reset --hard命令，根据指定的提交ID回退到指定版本  git reset --hard <CommitID>`**

**`#在旧版本中使用 git reflog --pretty=oneline 命令，查看命令操作的历史 `**

**`git reflog --pretty=oneline`**

**`#再次根据最新的提交ID，跳转到最新的版本 git reset --hard <CommitID> `**  

***

##### 20.`.gitignore`文件的例子

**`#忽略所有的.a文件  *.a`**

**`#但跟踪所有的lib.a,即便你在前面忽略了.a文件 !lib.a`**

**`#只忽略当前目录下的TODO文件，而不忽略subdir/TODO  /TODO`**

**`#忽略任何目录下名为build的文件夹  build/`**

**`#忽略 doc/notes.txt,但不忽略doc/server/arch.txt    doc/*.txt`**

**`#忽略doc/目录及其所有子目录的.pdf文件 doc/**/*.pdf`**

***

#### Git分支-本地分支操作

1. 分支的概念

   分支就是科幻电影里面的**平行宇宙**，当你正在电脑前努力学习Git的时候，另一个你正在另一个平行宇宙里努力学习SVN。

   如果两个平行宇宙互不干扰，那对现在的你也没啥影响。不过，**在某个时间点，两个平行宇宙合并了**，结果，你既学会了Git又学会SVN！

2. 分支在实际开发中的作用

   在进行多人协作开发的时候，为了防止互相干扰，提高协同开发的体验，建议每个开发者都基于分支进行项目功能的开发。

3. master主分支

   在初始化本地Git仓库的时候，Git默认已经帮我们创建了一个名叫作master的分支。通常我们把这个master分支叫做**主分支**。

   在实际工作中，master主分支的作用是：**用来保存和记录整个项目已完成的功能代码**。

   因此，不允许程序员直接在master分支上直接修改代码，因为这样做的风险太高了，容易导致整个项目崩溃。

4. 功能分支

   由于程序员不能直接在master分支上进行功能开发，所以就有了**功能分支**的概念。

   **功能分支**指的是**专门用来开发新功能的分支**，它是临时从master主分支上分叉出来的，当新功能开发且测试完毕后，最终需要合并到master分支上。

5. 查看分支列表

   **`#使用如下命令，可以查看当前Git仓库中所有的分支列表 git branch`**

6. 创建新分支

   **`#使用如下命令，可以基于当前的分支，创建一个新的分支，此时，新分支中的代码和当前分支完全一样： git branch + 分支名称`**

7. 切换分支

   **`#使用如下命令可以切换到指定的分支上进行开发 git checkout + 分支名称`**

8. 分支的快速创建和切换

   **`#使用如下命令可以创建指定名称的新分支，并立即切换到新的分支上 git checkout -b + 分支名称`**

9. 合并分支

   **`#功能分支的代码开发测试完毕之后，可以使用如下命令，将完成后的代码合并到master主分支上 `**

   **`git checkout master`**

    **` git merge + 分支名字  `**

   **`注意：假设要把C分支的代码合并到A分支，则必须先切换到A分支上，再进行git merge命令来合并C分支`**

10. 删除分支

    当把功能分支的代码合并到master主分支上以后，就可以使用如下命令，删除对应的功能分支

    **`git branch -d + 分支名称`**

11. 遇到冲突时的分支合作

    如果**在两个不同的分支中**，对**同一个文件**进行了**不同的修改**，Git就没，就办法合并他们。此时我们需要打开这些包含冲突的文件然后**手动解决冲突**。

    

***

#### Git分支-远程分支操作

1. 将本地分支推送到远程仓库

   如果是**第一次**将本地分支推送到远程仓库，需要运行如下的命令：

   **`#-u表示把本地分支和远程仓库进行关联，只在第一次推送的时候需要带-u参数 `**

   **`git push -u + 远程仓库的别名 + 本地分支名称：远程分支名称 （如果两名称保持一致，就可以进行简化，只写一个即可）`**

2. 查看远程仓库中所有的分支列表

   **`#通过如下的命令，可以查看远程中，所有分支列表的信息 git remote show + 远程仓库名称 `**

3. 跟踪分支

   跟踪分支指的是：从远程仓库中，把远程分支下载到本地仓库中。需要运行如下代码：

   **`#从远程仓库中，把对应的远程分支下载到本地仓库，保持本地分支和远程分支名称相同`**

   **`git checkout + 远程分支的名称`**

   **`#从远程仓库中，把对应的远程分支下载到本地仓库，并把下载的本地分支进行重命名`**

   **`git checkout -b + 本地分支名称/远程分支名称`**

4. 拉取远程分支的最新的代码

   可以运行如下命令，把远程分支最新的代码下载到本地对应的分支中

   **`#从远程仓库，拉取当前最新的代码，并保持当前分支的代码和远程分支代码一致`**

   **`git pull`**

5. 删除远程分支

   可以使用如下命令，删除远程仓库中指定的分支：

   **`#删除远程仓库中，指定名称的远程分支 git push + 远程仓库的名称 + --delete + 远程分支的名称`**

***

